<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>IJmeet</title>
    <link rel="stylesheet" type="text/css" href="https://opp.ijmeet.com/css/conf.css">
    <script src="https://opp.ijmeet.com/js/ijmeet_api_sdk.js"></script>
</head>
<body>
    <div id="IJmeetConfBase"></div>
    <div id="box-relative" class="box-relative">
        <div class="sk-cube-grid">
            <div class="sk-cube sk-cube1"></div>
            <div class="sk-cube sk-cube2"></div>
            <div class="sk-cube sk-cube3"></div>
            <div class="sk-cube sk-cube4"></div>
            <div class="sk-cube sk-cube5"></div>
            <div class="sk-cube sk-cube6"></div>
            <div class="sk-cube sk-cube7"></div>
            <div class="sk-cube sk-cube8"></div>
            <div class="sk-cube sk-cube9"></div>
        </div>
    </div>
    <script>
        // NOTE : get mdetail api response and store in localStorage like below
        const domain = localStorage.getItem("conference_url");
        const face_url = localStorage.getItem("face_url");
        const ROOM_NAME = localStorage.getItem('meeting_id');
        const USER_NAME = localStorage.getItem('username');
        const REDIRECT_URL = "https://opp.ijmeet.com";
        const APPURL = "https://opp.ijmeet.com";
        const SUBJECT = localStorage.getItem("meeting_name");
        const MEETING_TYPE = localStorage.getItem("meetingType");
        const MEETING_URL = localStorage.getItem("meetingURL");
        const PARTICIPANT_ID = localStorage.getItem("participant_id");
        const CONFIG = JSON.parse(localStorage.getItem("config"));
        var w = window.innerWidth;
        var h = window.innerHeight;
        if (!ROOM_NAME) {
            window.location.href = REDIRECT_URL;
        }
        var startWithVideoMuted = (CONFIG.startWithVideoMuted == "yes") ? true : false;
        var startWithAudioMuted = (CONFIG.startWithAudioMuted == "yes") ? true : false;
        var p2p = (CONFIG.p2p == "yes") ? true : false;
        var disableAP = (CONFIG.disableAP == "yes") ? true : false;
        var disableAEC = (CONFIG.disableAEC == "yes") ? true : false;
        var disableNS = (CONFIG.disableNS == "yes") ? true : false;
        var disableAGC = (CONFIG.disableAGC == "yes") ? true : false;
        var disableHPF = (CONFIG.disableHPF == "yes") ? true : false;
        var stereo = (CONFIG.stereo == "yes") ? true : false;

        const options = {
            roomName: ROOM_NAME,
            width: w,
            height: h,
            parentNode: document.querySelector('#IJmeetConfBase'),
            interfaceConfigOverwrite: {
                filmStripOnly: false,
                SHOW_JITSI_WATERMARK: false,
            },
            configOverwrite: {
                startWithVideoMuted: startWithVideoMuted,
                startWithAudioMuted: startWithAudioMuted,
                defaultLanguage: "ar",
            },
            userInfo: {
                displayName: USER_NAME,
                avatarURL: face_url,
                participantID: PARTICIPANT_ID,
                baseURL: APPURL + "/",
                languageSelcted: "ar",
            }
        };
        const api = new IJmeetAPISDK(domain, options);
        api.executeCommand('subject', SUBJECT);
        api.on('readyToClose', () => {
            localStorage.setItem('username', "");
            localStorage.setItem('meeting_id', "");
            localStorage.setItem('meeting_name', "");
            localStorage.setItem('meetingType', "");
            localStorage.setItem('meetingURL', "");
            localStorage.setItem('participant_id', "");
            fetch(APPURL + "/api/end-call/" + ROOM_NAME + "/" + PARTICIPANT_ID)
                .then(response => response.json())
                .then(data => {
                    window.location.href = REDIRECT_URL;
                })
                .catch((error) => {
                    window.location.href = REDIRECT_URL;
                });
        });
    </script>
    <script type="text/javascript" src="https://opp.ijmeet.com/js/conf.js"></script>
</body>

</html>